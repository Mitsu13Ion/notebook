<h4>
  <%= link_to data_vault_path, class: 'grey-text tooltipped', style: 'position: relative; top: 4px;', data: {
        position: 'bottom',
        enterDelay: '500',
        tooltip: "Back to your Data Vault"
      } do %>
    <i class="material-icons">arrow_back</i>
  <% end %>
  Document statistics
</h4>

<div class="row">
  <div class="col s12 m4 l4">
    <div class="card-panel center <%= Document.color %> white-text">
      <h1 style="margin: 0">
        <%= number_with_delimiter @documents.sum { |doc| doc.cached_word_count || 0 } %>
      </h1>
      total words written
    </div>
  </div>
  <div class="col s12 m4 l4">
    <div class="card-panel center <%= Document.color %> white-text">
      <h1 style="margin: 0">
        <%= number_with_delimiter @documents.count %>
      </h1>
      total documents
    </div>
  </div>
  <div class="col s12 m4 l4">
    <div class="card-panel center <%= Document.color %> white-text">
      <h1 style="margin: 0">
        <%= number_with_delimiter @revisions.count %>
      </h1>
      document versions
    </div>
  </div>

  <div class="col s12">
    <div class="card">
      <div class="card-content">
        <div class="card-title">You've written <%= pluralize @documents.count, 'document' %> on Notebook.ai</div>

        <table class="striped">
          <thead>
            <tr>
              <th>Title</th>
              <th>Word count</th>
              <th>History</th>
              <th>Analyzed?</th>
            </tr>
          </thead>

          <tbody>
            <% @documents.each do |document| %>
              <tr>
                <td>
                  <i class="material-icons left <%= Document.color %>-text"><%= Document.icon %></i>
                  <%= link_to document.title, document, class: "#{Document.color}-text" %>
                </td>
                <td>
                  <%= number_with_delimiter(document.cached_word_count || 0) %>
                  <%= 'word'.pluralize(document.cached_word_count || 0) %>
                </td>
                <td>
                  <div>
                    Created <%= time_ago_in_words document.created_at %> ago
                    <span class="grey-text">
                      (<%= document.created_at.strftime("%m/%d/%Y") %>)
                    </span>
                  </div>
                  <div>
                    Last updated <% time_ago_in_words document.updated_at %> ago
                    <span class="grey-text">
                      (<%= document.updated_at.strftime("%m/%d/%Y") %>)
                    </span>
                  </div>
                </td>
                <td>
                  <% if document.document_analysis.where.not(completed_at: nil).any? %>
                    <strong>
                      <%= link_to 'Yes', analysis_document_path(document), class: 'orange-text' %>
                    </strong>                
                  <% else %>
                    <%= link_to 'No', analysis_document_path(document) %>
                  <% end %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="col s12">
    <div class="card">
      <div class="card-content">
        <div class="card-title">Writing activity over time</div>
        <p>
          Notebook.ai automatically creates backups of your documents as often as every five minutes as you're writing.
          The following charts estimate approximately how much time you spend writing in Notebook.ai each day
          based on how many of those automatic backups were created.
        </p>
        <br />
        <%=
          line_chart @revisions.where('created_at > ?', Date.current - 45.days).group_by_day(:created_at).map { |ts, c|
            [ts.split(' ').first, c * 5]
          },
          title: "Last 45 days",
          ytitle: "minutes",
          colors: [Document.color],
          suffix: " minutes"
        %>
        <br />
        <%=
          line_chart @revisions.group_by_day(:created_at).map { |ts, c|
            [ts.split(' ').first, c * 5]
          },
          title: "All time",
          ytitle: "minutes",
          colors: [Document.color],
          suffix: " minutes"
        %>
        <br />
        <div class="center">
          You have written something in a Notebook.ai document on
          <strong>
            <%= @revisions.group_by_day(:created_at).keys.count %>
            different days!
          </strong>
        </div>
      </div>
    </div>
  </div>
</div>